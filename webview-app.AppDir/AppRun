#!/bin/sh
# Detect display backend and set correct environment variables
if [ -n "$WAYLAND_DISPLAY" ]; then
    export GDK_BACKEND=wayland
    export WEBKIT_DISABLE_COMPOSITING_MODE=1
else
    export GDK_BACKEND=x11
fi

export GST_PLUGIN_PATH="$APPDIR/usr/lib/gstreamer-1.0"
export LD_LIBRARY_PATH="$APPDIR/usr/lib:$LD_LIBRARY_PATH"

# Run the application
HERE="$(dirname "$(readlink -f "$0")")"

if [[ "$@" =~ ^(http) ]]; then
    exec "$HERE/usr/bin/webviewer" "$@"
elif [[ "$@" =~ (.html) ]]; then
    if [[ "$@" =~ ^(/) ]]; then
        ! [[ -f "$@" ]] && echo -e "ERROR: File Not Found! ($@)" && exit 1
        exec "$HERE/usr/bin/localviewer" "$@"
    else
        ! [[ -f "$PWD/$@" ]] && echo -e "ERROR: File Not Found! ($PWD/$@)" && exit 1
        exec "$HERE/usr/bin/localviewer" "$PWD/$@"
    fi
else
    # Uncomment and run html file :)
    #exec "$HERE/usr/bin/localviewer" $HERE/usr/web/index.html
    echo -e "You can just set path of html file or valid URL!"
    exit 1
fi


